<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboardé‡å¯å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
        }
        .success {
            background: #28a745;
        }
        .success:hover {
            background: #1e7e34;
        }
        .warning {
            background: #ffc107;
            color: #212529;
        }
        .warning:hover {
            background: #e0a800;
        }
        .status {
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .status.show {
            display: block;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ Dashboardé‡å¯å·¥å…·</h1>
        
        <div class="info">
            <strong>å½“å‰çŠ¶æ€:</strong><br>
            å¦‚æœDashboardä¸€ç›´æ˜¾ç¤º"åŠ è½½ä¸­..."ï¼Œä½¿ç”¨æ­¤å·¥å…·é‡æ–°å¯åŠ¨ã€‚
        </div>
        
        <div class="actions">
            <button onclick="checkStatus()" class="warning">æ£€æŸ¥å½“å‰çŠ¶æ€</button>
            <button onclick="restartDashboard()" class="success">é‡æ–°å¯åŠ¨Dashboard</button>
            <button onclick="clearAllAndRestart()">æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡å¯</button>
            <button onclick="goToSessionSelection()">è¿”å›æœŸæ¬¡é€‰æ‹©</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div id="log" class="log" style="display: none;">
            <div id="log-content"></div>
        </div>
        
        <div class="info">
            <strong>æ­¥éª¤è¯´æ˜ï¼š</strong><br>
            1. å…ˆç‚¹å‡»"æ£€æŸ¥å½“å‰çŠ¶æ€"æŸ¥çœ‹é—®é¢˜<br>
            2. ç‚¹å‡»"é‡æ–°å¯åŠ¨Dashboard"å°è¯•ä¿®å¤<br>
            3. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œç‚¹å‡»"æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡å¯"<br>
            4. æœ€åé€‰æ‹©"è¿”å›æœŸæ¬¡é€‰æ‹©"é‡æ–°å¼€å§‹
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            
            logContent.textContent += `[${timestamp}] ${message}\n`;
            logDiv.style.display = 'block';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.className = `status show ${type}`;
            status.textContent = message;
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        function checkStatus() {
            log('=== æ£€æŸ¥å½“å‰çŠ¶æ€ ===');
            
            // æ£€æŸ¥localStorage
            const authToken = localStorage.getItem('auth_token');
            const userRole = localStorage.getItem('user_role');
            const userEmail = localStorage.getItem('user_email');
            const selectedSessionId = localStorage.getItem('selectedSessionId');
            const demoUser = localStorage.getItem('demo_user');
            
            log(`auth_token: ${authToken ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            log(`user_role: ${userRole || 'æœªè®¾ç½®'}`);
            log(`user_email: ${userEmail || 'æœªè®¾ç½®'}`);
            log(`selectedSessionId: ${selectedSessionId || 'æœªè®¾ç½®'}`);
            log(`demo_user: ${demoUser ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            
            // æ£€æŸ¥å½“å‰URL
            log(`å½“å‰URL: ${window.location.href}`);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
            if (!authToken && !demoUser) {
                log('âŒ é—®é¢˜ï¼šç¼ºå°‘è®¤è¯ä¿¡æ¯');
                showStatus('å‘ç°é—®é¢˜ï¼šç¼ºå°‘è®¤è¯ä¿¡æ¯', 'error');
            } else if (!selectedSessionId || selectedSessionId === 'default-session-id') {
                log('âš ï¸ é—®é¢˜ï¼šæœŸæ¬¡é€‰æ‹©å¯èƒ½æœ‰é—®é¢˜');
                showStatus('å‘ç°é—®é¢˜ï¼šæœŸæ¬¡é€‰æ‹©å¼‚å¸¸', 'warning');
            } else {
                log('âœ… åŸºæœ¬çŠ¶æ€æ­£å¸¸');
                showStatus('åŸºæœ¬çŠ¶æ€æ£€æŸ¥é€šè¿‡', 'success');
            }
        }

        function restartDashboard() {
            log('=== é‡æ–°å¯åŠ¨Dashboard ===');
            
            // ç¡®ä¿æœ‰åŸºæœ¬çš„è®¤è¯çŠ¶æ€
            if (!localStorage.getItem('auth_token') && !localStorage.getItem('demo_user')) {
                log('è®¾ç½®åŸºæœ¬è®¤è¯çŠ¶æ€...');
                localStorage.setItem('auth_token', 'student_auth_token');
                localStorage.setItem('user_role', 'student');
                localStorage.setItem('user_email', 'student@test.com');
                localStorage.setItem('login_time', new Date().toISOString());
            }
            
            // ç¡®ä¿æœ‰æœŸæ¬¡é€‰æ‹©
            if (!localStorage.getItem('selectedSessionId') || localStorage.getItem('selectedSessionId') === 'default-session-id') {
                log('è®¾ç½®é»˜è®¤æœŸæ¬¡...');
                localStorage.setItem('selectedSessionId', '3aec32c0-11f9-4dd4-935e-67b3b8b20974'); // ä½¿ç”¨APIè¿”å›çš„çœŸå®æœŸæ¬¡ID
            }
            
            log('è§¦å‘é¡µé¢é‡æ–°åŠ è½½...');
            showStatus('æ­£åœ¨é‡å¯Dashboard...', 'success');
            
            setTimeout(() => {
                window.location.href = '/student/dashboard';
            }, 1000);
        }

        function clearAllAndRestart() {
            log('=== æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡å¯ ===');
            
            // æ¸…é™¤æ‰€æœ‰localStorage
            localStorage.clear();
            sessionStorage.clear();
            log('å·²æ¸…é™¤æ‰€æœ‰å­˜å‚¨æ•°æ®');
            
            // é‡æ–°è®¾ç½®åŸºæœ¬çŠ¶æ€
            log('é‡æ–°è®¾ç½®è®¤è¯çŠ¶æ€...');
            localStorage.setItem('auth_token', 'student_auth_token');
            localStorage.setItem('user_role', 'student');
            localStorage.setItem('user_email', 'student@test.com');
            localStorage.setItem('login_time', new Date().toISOString());
            localStorage.setItem('selectedSessionId', '3aec32c0-11f9-4dd4-935e-67b3b8b20974');
            
            showStatus('æ­£åœ¨å…¨é¢é‡å¯...', 'success');
            
            setTimeout(() => {
                window.location.href = '/student/dashboard';
            }, 1500);
        }

        function goToSessionSelection() {
            log('=== è¿”å›æœŸæ¬¡é€‰æ‹© ===');
            
            // æ¸…é™¤æœŸæ¬¡ç›¸å…³è®¾ç½®
            localStorage.removeItem('selectedSessionId');
            log('å·²æ¸…é™¤æœŸæ¬¡é€‰æ‹©');
            
            showStatus('æ­£åœ¨è·³è½¬åˆ°æœŸæ¬¡é€‰æ‹©...', 'success');
            
            setTimeout(() => {
                window.location.href = '/student/session-selection';
            }, 1000);
        }
    </script>
</body>
</html>
